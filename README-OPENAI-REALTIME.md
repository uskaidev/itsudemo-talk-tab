# OpenAI Realtime API 実装ガイド

このドキュメントでは、Heygenのインタラクティブアバターの代わりにOpenAI Realtime APIを使用した音声会話システムの実装について説明します。

## 概要

OpenAI Realtime APIは、低レイテンシーでマルチモーダルな会話体験を構築するためのAPIです。このAPIを使用することで、リアルタイムの音声入出力が可能になります。

## 前提条件

- OpenAI APIキー（GPT-4oモデルへのアクセス権が必要）
- HTTPS環境（WebRTCの要件）

## セットアップ手順

### 1. 環境変数の設定

`.env.local`ファイルにOpenAI APIキーを追加します：

```
OPENAI_API_KEY=your_openai_api_key_here
```

### 2. HTTPSでの開発サーバー起動

WebRTCはHTTPS環境が必要なため、以下のコマンドで開発サーバーを起動します：

```bash
npm run dev:https
```

または：

```bash
node start-https.js
```

ブラウザで証明書の警告が表示されますが、「詳細設定」→「安全でないサイトにアクセスする」を選択してください。

## 実装の詳細

### コンポーネント構成

1. **OpenAIRealtimeAvatar**
   - WebRTCを使用してOpenAI Realtime APIと通信
   - 音声入出力の処理
   - 音声認識中のインジケーター表示

2. **APIルート**
   - `app/api/realtime-token/route.ts`: エフェメラルトークン生成用のAPIルート

### 使用技術

- **WebRTC**: ブラウザでのリアルタイム通信
- **OpenAI Realtime API**: GPT-4oモデルを使用した音声会話
- **Next.js**: フロントエンドフレームワーク

## 注意点

1. **API料金**: OpenAI Realtime APIは料金が発生します。使用量に応じた課金が発生するため、予算を考慮する必要があります。

2. **HTTPS要件**: WebRTCはHTTPS環境でのみ動作します。開発環境でもHTTPSが必要です。

3. **ブラウザ互換性**: WebRTCはモダンブラウザでサポートされていますが、古いブラウザでは動作しない可能性があります。

4. **マイク許可**: ブラウザでマイク入力を許可する必要があります。

## トラブルシューティング

### WebRTCの接続エラー

- ブラウザがHTTPS環境で実行されていることを確認してください。
- ブラウザでマイクへのアクセスが許可されていることを確認してください。
- OpenAI APIキーが正しく設定されていることを確認してください。

### 音声認識の問題

- マイクが正しく接続されていることを確認してください。
- ブラウザの設定でマイクが有効になっていることを確認してください。

## 本番環境での注意点

本番環境では、以下の点に注意してください：

1. **APIキーの保護**: クライアントサイドでAPIキーを直接使用しないでください。常にサーバーサイドでエフェメラルトークンを生成してください。

2. **HTTPS**: 本番環境では必ずHTTPSを使用してください。

3. **エラーハンドリング**: 適切なエラーハンドリングを実装して、ユーザーエクスペリエンスを向上させてください。
